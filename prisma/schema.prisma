generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Status {
  ACTIVE
  INACTIVE
}

enum LogType {
  PRESENT
  LATE
  ABSENT
  SICK
  LEAVE
  OVERTIME
}

enum TypePayroll {
  MONTHLY
  BONUS
  ADHOC
}

enum StatusPayroll {
  DRAFT
  POSTED
  PAID
  CANCELLED
}

enum TypeDeduction {
  MONTHLY
  SEMI_MONTHLY
  ONCE
}

enum TypeAllowance {
  MONTHLY
  SEMI_MONTHLY
  ONCE
}

enum Role {
  SUPER_ADMIN
  ADMIN
}

model Employee {
  id               String               @id @default(uuid())
  employee_number  String               @unique
  name             String
  email            String               @unique
  profile_uri      String?
  status           Status               @default(ACTIVE)
  join_date        DateTime
  departmentId     String
  positionId       String
  salary           Int
  created_at       DateTime             @default(now())
  updated_at       DateTime             @updatedAt

  department       Department           @relation(fields: [departmentId], references: [id])
  position         Position             @relation(fields: [positionId], references: [id])

  employeeAllowances  EmployeeAllowances[]
  employeeDeductions  EmployeeDeductions[]
  attendance          Attendance[]
  payrollItems        PayrollItem[]

  @@map("Employee")
}

model Department {
  id          String     @id @default(uuid())
  name        String
  start_salary Int
  end_salary   Int
  description  String?
  created_at   DateTime   @default(now())
  updated_at   DateTime   @updatedAt

  employees  Employee[]
  positions  Position[]

  @@map("Department")
}

model Position {
  id           String     @id @default(uuid())
  name         String      
  departmentId String
  created_at   DateTime   @default(now())
  updated_at   DateTime   @updatedAt

  department   Department @relation(fields: [departmentId], references: [id])
  employees    Employee[]
  levels      PositionLevel[]

  @@map("Position")
}

model PositionLevel {
  id            String    @id @default(uuid())
  positionId    String
  name          String

  position    Position    @relation(fields: [positionId], references: [id])

  @@map("Position_level")
}



//Tunjangan
model Allowances {
  id          String      @id @default(uuid())
  allowance   String
  description String?
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt

  employeeAllowances EmployeeAllowances[]

  @@map("Allowances")
}

model EmployeeAllowances {
  id             String    @id @default(uuid())
  employeeId     String
  allowanceId    String
  type           TypeAllowance
  amount         Int
  effective_date DateTime
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  employee   Employee   @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  allowance  Allowances @relation(fields: [allowanceId], references: [id])

  @@map("Employee_Allowances")
}

//pemotongan gaji
model Deductions {
  id          String      @id @default(uuid())
  deduction   String
  description String?
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt

  employeeDeductions EmployeeDeductions[]

  @@map("Deductions")
}

model EmployeeDeductions {
  id             String    @id @default(uuid())
  employeeId     String
  deductionId    String
  type           TypeDeduction
  amount         Int
  effective_date DateTime
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  employee  Employee   @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  deduction Deductions @relation(fields: [deductionId], references: [id])

  @@map("Employee_Deductions")
}

// Kehadiran
model Attendance {
  id           String   @id @default(uuid())
  employeeId   String
  log_type     LogType
  datetime_log DateTime
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("Attendance")
}

//gaji
model Payroll {
  id           String        @id @default(uuid())
  ref_no       String
  date_from    DateTime
  date_to      DateTime
  type         TypePayroll
  status       StatusPayroll
  created_at   DateTime      @default(now())
  updated_at   DateTime      @updatedAt

  items PayrollItem[]

  @@map("Payroll")
}

model PayrollItem {
  id               String   @id @default(uuid())
  payrollId        String
  employeeId       String
  present          Int?
  absent           Int?
  late             Int?
  salary           Decimal?    // gunakan Decimal untuk akurasi keuangan
  allowance_amount Decimal?
  deductions       Decimal?
  net              Decimal?
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  payroll  Payroll  @relation(fields: [payrollId], references: [id])
  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("Payroll_Item")
}

model User {
  id            String     @id @default(uuid())
  first_name    String
  last_name     String
  email         String     @unique
  password      String
  profile_uri   String?
  role          Role       @default(ADMIN)
  created_at    DateTime   @default(now())
  updated_at    DateTime   @updatedAt
  deleted_at    DateTime?

  @@map("users")
}
