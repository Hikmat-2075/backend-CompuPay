generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Status {
  ACTIVE
  INACTIVE
}

enum LogType {
  PRESENT
  LATE
  ABSENT
  SICK
  LEAVE
  OVERTIME
}

enum TypePayroll {
  MONTHLY
  SEMI_MONTHLY
}

enum StatusPayroll {
  PENDING
  PAID
  CANCELLED
}

enum TypeDeduction {
  MONTHLY
  SEMI_MONTHLY
  ONCE
}

enum TypeAllowance {
  MONTHLY
  SEMI_MONTHLY
  ONCE
}

enum Role {
  USER
  ADMIN
}

model Otp {
  email      String   @id 
  otp        String
  expired_at DateTime
  created_at DateTime @default(now())
}

model User {
  id               String               @id @default(uuid())
  employee_number  String               @unique
  first_name       String
  last_name        String
  email            String               @unique
  password         String
  profile_uri      String?
  role             Role
  status           Status               @default(ACTIVE)
  join_date        DateTime
  departmentId     String
  positionId       String
  salary           Int
  created_at       DateTime             @default(now())
  updated_at       DateTime             @updatedAt

  department       Department           @relation(fields: [departmentId], references: [id])
  position         Position             @relation(fields: [positionId], references: [id])

  employeeAllowances  EmployeeAllowances[]
  employeeDeductions  EmployeeDeductions[]
  attendance          Attendance[]
  payroll       Payroll[]

  @@map("users")
}

model Department {
  id          String     @id @default(uuid())
  name        String
  start_salary Int
  end_salary   Int
  description  String?
  created_at   DateTime   @default(now())
  updated_at   DateTime   @updatedAt

  users  User[]
  positions  Position[]

  @@map("Department")
}

model Position {
  id           String     @id @default(uuid())
  name         String      
  departmentId String
  created_at   DateTime   @default(now())
  updated_at   DateTime   @updatedAt

  department   Department @relation(fields: [departmentId], references: [id])
  users    User[]
  levels      PositionLevel[]

  @@map("Position")
}

model PositionLevel {
  id            String    @id @default(uuid())
  positionId    String
  name          String

  position    Position    @relation(fields: [positionId], references: [id])

  @@map("Position_level")
}



//Tunjangan
model Allowances {
  id          String      @id @default(uuid())
  allowance   String
  description String?
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt

  employeeAllowances EmployeeAllowances[]

  @@map("Allowances")
}

model EmployeeAllowances {
  id             String    @id @default(uuid())
  userId     String
  allowanceId    String
  type           TypeAllowance
  amount         Int
  effective_date DateTime
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  users   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  allowance  Allowances @relation(fields: [allowanceId], references: [id])

  @@map("Employee_Allowances")
}

//pemotongan gaji
model Deductions {
  id          String      @id @default(uuid())
  deduction   String
  description String?
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt

  employeeDeductions EmployeeDeductions[]

  @@map("Deductions")
}

model EmployeeDeductions {
  id             String    @id @default(uuid())
  userId     String
  deductionId    String
  type           TypeDeduction
  amount         Int
  effective_date DateTime
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt

  users  User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  deduction Deductions @relation(fields: [deductionId], references: [id])

  @@map("Employee_Deductions")
}

// Kehadiran
model Attendance {
  id           String   @id @default(uuid())
  userId   String
  log_type     LogType
  datetime_log DateTime
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  users User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("Attendance")
}

//gaji
model Payroll {
  id               String        @id @default(uuid())
  ref_no           String        @unique
  employeeId       String
  date_from        DateTime
  date_to          DateTime
  type             TypePayroll
  status           StatusPayroll
  present          Int?
  absent           Int?
  late             Int?
  salary           Decimal?
  allowance_amount Decimal?
  deductions       Decimal?
  net              Decimal?
  created_at       DateTime      @default(now())
  updated_at       DateTime      @updatedAt

  employee User @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("Payroll")

  @@index([employeeId])
}

